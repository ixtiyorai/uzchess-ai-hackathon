<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ChessAI Opening Recommender | UzChess AI Hackathon</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .chess-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .chess-piece {
            font-size: 2rem;
        }
        
        .recommendation-card {
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .recommendation-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
        
        .loading-spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }
            100% {
                transform: rotate(360deg);
            }
        }
    </style>
</head>

<body class="bg-gray-50">
    <!-- Header -->
    <header class="chess-bg text-white py-8">
        <div class="container mx-auto px-4">
            <div class="text-center">
                <h1 class="text-4xl font-bold mb-2">
                    <i class="fas fa-chess-knight mr-3"></i> ChessAI Opening Recommender
                </h1>
                <p class="text-xl opacity-90">AI-Powered Chess Opening Recommendations for UzChess</p>
                <div class="mt-4 text-sm opacity-80">
                    <span class="bg-white bg-opacity-20 px-3 py-1 rounded-full mr-2">
                        <i class="fas fa-trophy mr-1"></i> UzChess AI Hackathon 2025
                    </span>
                    <span class="bg-white bg-opacity-20 px-3 py-1 rounded-full">
                        <i class="fas fa-robot mr-1"></i> Machine Learning Powered
                    </span>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-8">
        <!-- Input Section -->
        <div class="max-w-md mx-auto mb-8">
            <div class="bg-white rounded-lg shadow-lg p-6">
                <h2 class="text-2xl font-semibold text-gray-800 mb-6 text-center">
                    <i class="fas fa-sliders-h mr-2 text-purple-600"></i> Get Your Recommendations
                </h2>

                <form id="recommendationForm" class="space-y-4">
                    <!-- Rating Input -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            <i class="fas fa-chart-line mr-1"></i> Your Chess Rating
                        </label>
                        <input type="number" id="rating" min="400" max="3000" value="1200" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500" placeholder="Enter your rating (400-3000)">
                        <p class="text-xs text-gray-500 mt-1">Your current chess rating (Elo)</p>
                    </div>

                    <!-- Color Selection -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            <i class="fas fa-palette mr-1"></i> Playing Color
                        </label>
                        <div class="flex space-x-4">
                            <label class="flex items-center">
                                <input type="radio" name="colour" value="White" checked 
                                       class="text-purple-600 focus:ring-purple-500">
                                <span class="ml-2 chess-piece">♕</span>
                                <span class="ml-1">White</span>
                            </label>
                            <label class="flex items-center">
                                <input type="radio" name="colour" value="Black"
                                       class="text-purple-600 focus:ring-purple-500">
                                <span class="ml-2 chess-piece">♛</span>
                                <span class="ml-1">Black</span>
                            </label>
                        </div>
                    </div>

                    <!-- Number of Recommendations -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            <i class="fas fa-list-ol mr-1"></i> Number of Recommendations
                        </label>
                        <select id="count" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
                            <option value="3">Top 3</option>
                            <option value="5" selected>Top 5</option>
                            <option value="7">Top 7</option>
                            <option value="10">Top 10</option>
                        </select>
                    </div>

                    <!-- Submit Button -->
                    <button type="submit" class="w-full bg-purple-600 hover:bg-purple-700 text-white font-semibold py-3 px-6 rounded-lg transition duration-200 flex items-center justify-center">
                        <span id="button-text">
                            <i class="fas fa-magic mr-2"></i>
                            Get AI Recommendations
                        </span>
                        <div id="loading-spinner" class="loading-spinner hidden ml-2"></div>
                    </button>
                </form>
            </div>
        </div>

        <!-- Results Section -->
        <div id="results" class="hidden">
            <div class="text-center mb-6">
                <h3 class="text-2xl font-semibold text-gray-800">
                    <i class="fas fa-lightbulb mr-2 text-yellow-500"></i> AI Recommendations for You
                </h3>
                <p id="results-subtitle" class="text-gray-600 mt-2"></p>
            </div>

            <div id="recommendations" class="grid gap-4 md:grid-cols-2 lg:grid-cols-3"></div>
        </div>

        <!-- Error Message -->
        <div id="error" class="hidden max-w-md mx-auto">
            <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg">
                <div class="flex items-center">
                    <i class="fas fa-exclamation-triangle mr-2"></i>
                    <span id="error-message">Something went wrong!</span>
                </div>
            </div>
        </div>

        <!-- Features Section -->
        <div class="mt-16 grid md:grid-cols-3 gap-8">
            <div class="text-center">
                <div class="bg-blue-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i class="fas fa-brain text-2xl text-blue-600"></i>
                </div>
                <h4 class="text-lg font-semibold mb-2">AI-Powered Analysis</h4>
                <p class="text-gray-600">Machine learning model trained on thousands of chess games</p>
            </div>
            <div class="text-center">
                <div class="bg-green-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i class="fas fa-user-cog text-2xl text-green-600"></i>
                </div>
                <h4 class="text-lg font-semibold mb-2">Personalized Recommendations</h4>
                <p class="text-gray-600">Tailored opening suggestions based on your rating and style</p>
            </div>
            <div class="text-center">
                <div class="bg-purple-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i class="fas fa-chart-line text-2xl text-purple-600"></i>
                </div>
                <h4 class="text-lg font-semibold mb-2">Data-Driven Insights</h4>
                <p class="text-gray-600">Win rates and statistics from real tournament games</p>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white py-6 mt-16">
        <div class="container mx-auto px-4 text-center">
            <p>&copy; 2025 ChessAI Opening Recommender | UzChess AI Hackathon</p>
            <p class="text-sm text-gray-400 mt-2">Built with Flask, scikit-learn, and lots of ♥ for chess</p>
        </div>
    </footer>

    <script>
        const form = document.getElementById('recommendationForm');
        const results = document.getElementById('results');
        const error = document.getElementById('error');
        const buttonText = document.getElementById('button-text');
        const loadingSpinner = document.getElementById('loading-spinner');

        form.addEventListener('submit', async function(e) {
            e.preventDefault();

            // Show loading state
            buttonText.innerHTML = '<i class="fas fa-cog fa-spin mr-2"></i>Analyzing...';
            loadingSpinner.classList.remove('hidden');
            results.classList.add('hidden');
            error.classList.add('hidden');

            // Get form data
            const formData = new FormData(form);
            const data = {
                rating: parseInt(formData.get('rating') || document.getElementById('rating').value),
                colour: formData.get('colour'),
                count: parseInt(document.getElementById('count').value)
            };

            try {
                const response = await fetch('/api/recommend', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });

                const result = await response.json();

                if (result.success) {
                    displayRecommendations(result);
                } else {
                    showError(result.error || 'Failed to get recommendations');
                }
            } catch (err) {
                showError('Network error. Please try again.');
                console.error('Error:', err);
            } finally {
                // Reset button state
                buttonText.innerHTML = '<i class="fas fa-magic mr-2"></i>Get AI Recommendations';
                loadingSpinner.classList.add('hidden');
            }
        });

        function displayRecommendations(data) {
            const subtitle = document.getElementById('results-subtitle');
            const container = document.getElementById('recommendations');

            subtitle.textContent = `Recommended openings for ${data.user_rating} rating player (${data.colour} pieces)`;

            container.innerHTML = data.recommendations.map((rec, index) => {
                const medalColor = index === 0 ? 'text-yellow-500' : index === 1 ? 'text-gray-400' : index === 2 ? 'text-yellow-600' : 'text-gray-500';
                const medal = index < 3 ? `<i class="fas fa-medal ${medalColor} mr-2"></i>` : `<span class="text-gray-500 mr-3">${index + 1}.</span>`;

                return `
                    <div class="recommendation-card bg-white rounded-lg shadow-md p-6">
                        <div class="flex items-start mb-3">
                            ${medal}
                            <h4 class="text-lg font-semibold text-gray-800 flex-1">${rec.opening}</h4>
                        </div>
                        
                        <div class="space-y-2 mb-4">
                            <div class="flex justify-between items-center">
                                <span class="text-sm text-gray-600">Win Rate:</span>
                                <span class="font-semibold text-green-600">${rec.win_rate}%</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-sm text-gray-600">Games Played:</span>
                                <span class="font-semibold">${rec.total_games.toLocaleString()}</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-sm text-gray-600">Rating Match:</span>
                                <span class="font-semibold text-blue-600">${rec.rating_match}%</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-sm text-gray-600">Difficulty:</span>
                                <span class="font-semibold text-purple-600">${rec.difficulty}</span>
                            </div>
                        </div>
                        
                        <div class="border-t pt-3">
                            <p class="text-xs text-gray-500 mb-1">Opening Moves:</p>
                            <p class="text-sm font-mono bg-gray-100 p-2 rounded">${rec.moves}</p>
                        </div>
                    </div>
                `;
            }).join('');

            results.classList.remove('hidden');
        }

        function showError(message) {
            document.getElementById('error-message').textContent = message;
            error.classList.remove('hidden');
        }
    </script>
</body>

</html>